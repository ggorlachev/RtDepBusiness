.. _config_tps:

Конфигурация системы планирования
=================================

Архитектура конфигурации **Eclipse**
------------------------------------

Описание дистанционных аппаратов
--------------------------------

Определение аппаратов (ускорители, CT, симуляторы, брахитерапия и т.д.) происходит по ссылке
**RT Administration** -> **Radiation and Imaging Devices**.

Аппараты можно создавать импортируя из XML файла или с помощью *Wizard*.
Описание процесса содержится в учебном руководстве начиная со страницы 167.

На рисунке :numref:`(Рис. %s) <_truebeam_head-figure>`
геометрия радиационной головки **TrueBeam** и **TrueBeam STx**.

.. figure:: images/TrueBeamHead.png
    :name: _truebeam_head-figure
    :align: center
    :width: 100%
    :figclass: align-center

    Геометрия радиационной головки TrueBeam и TrueBeam STx.


Определение CT томографов и их калибровка
-----------------------------------------

Определение CT томографа происходит по ссылке
**RT Administration** -> **Radiation and Imaging Devices**.

Работа с томографами описывается в учебном руководстве начиная со страницы 216.

Среди настроек есть параметры, по которым определяется сканер из DICOM Tags.

Интерпретация чисел Хаусфильда зависит от алгоритма расчета дозы.
Описание приводится на рисунке :numref:`(Рис. %s) <_truebeam_head-figure>`.

.. figure:: images/CT_vs_Algorihm.png
    :name: _ct_vs_algorihm-figure
    :align: center
    :width: 80%
    :figclass: align-center

    Интерпретация чисел Хаусфильда в зависти от алгоритма расчета дозы.

Распределенные вычисления (**DCF**)
-----------------------------------

**DCF** инфраструктура распределенных вычислений обслуживает расчет дозы и оптимизацию в *Eclipse*.
В состав входят **Distributor** и **Agents**.
Распределитель располагается на сервере баз данных.
Агенты на клиентски станциях. 

**Distributor** работает как сервис *Varian DCF Distributor*.
Предоставляет информацию о своей работе через встроенный *HTTP server*.

**Agent** работает как сервис *Varian DCF Agent*.
Запускает серванты.

**Servant** представляет собой исполняемую программу и DCF-interface library (*VCServant.DLL*).
Реализует алгоритмы расчета дозы.
Каждый предоставляет один или более вычислительный сервис.

**GPU servant** может считать *Acuros* и *PO/FTDC* на *GPU*.
*GPU* может устанавливаться на локальной машине и на сервере (**FAS**)

Вычислительные алгоритмы **Eclipse**
------------------------------------

На рисунке :numref:`(Рис. %s) <_eclipse_algorithms-figure>`
перечислены все вычислительные алгоритмы *Eclipse*.

.. figure:: images/EclipseAlgorithms.png
    :name: _eclipse_algorithms-figure
    :align: center
    :width: 100%
    :figclass: align-center

    Вычислительные алгоритмы **Eclipse**.

Для расчетов требуются алгоритмы и данные полей облучения.
*Leaf Motion Calculation* (**LMC**) не нуждается в полях облучения.
Поэтому в конфигурации *LMC* не отражается.

Модели полей облучения
----------------------

Модели полей облучения организованы в структуру *machine* **add-ons**. 

Каждая модель имеет собственную разделяемую папку на сервере в разделе:

.. code-block:: none

    \\m66-vcom-01\DCF$\client\BeamData

В корне каждого алгоритма лежит файл **mapfile.txt**.
В нем содержится привязка модели полей облучения к аппарату.
Менять этот файл вручную нельзя.

Модели источника
----------------

Модели логично разделяют источники на компоненты (идентично Амфоре):
первичный, рассеяние в головке, загрязняющие электроны и рассеяние в твердом клине.

Моделирование источника подробно рассматривается в учебном руководстве начиная со страницы 259.

Алгоритмы расчета дозы
----------------------

Anisotropic Analytical Algorithm (AAA) for Photons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Подробно рассматривается в учебном руководстве начиная со страницы 275.

Acuros External Beam Algorithm
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Подробно рассматривается в учебном руководстве начиная со страницы 294.

*Linear Boltzmann Transport Equaion* (**LBTE**) solver by Todd Wareing and John McGhee (Tanspire Inc).

Electron Monte Carlo Algorithm (**eMMC**)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Подробно рассматривается в учебном руководстве начиная со страницы 331.

Включает модель источника и модель транспорта.
Источник моделируется пятью подисточниками.
Основывается на предварительных расчетах различных типов машин.

Наборы экспериментальных данных и конфигурация
----------------------------------------------

Замечания:

- Все относительные измерения должны быть пи одном *SPD*.
- Измерения для калибровки по абсолютной дозе могут быть при другом *SPD*.
- Поперечные профили могут быть вдоль in-plane (Y) или crosplane (X).
- **Effective spot size** (X and Y) существенно влияет на мониторные единицы малых полей и хвосты. 
  Их величину можно (и нужно) подстраивать позднее сравнивая измеренные и расчетные данные.

Дополнительные устройства
-------------------------


Архитектура компьютерной сети
-----------------------------


Архитектура баз данных SQL
--------------------------
